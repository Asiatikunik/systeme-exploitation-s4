#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <unistd.h>
#include <pthread.h>

// compiler avec -lpthread a la fin pour que ca marche

typedef struct {
	int deb;
	int fin; int res; int *tab;

} Tableau;

void *cherche(void *a) {
	
	int i;
	Tableau *t=(Tableau *)a;
	t->res=-1;
	for(i=t->deb;i<t->fin;i++){
		if( t->res <t->tab[i])
			t->res=t->tab[i];
	}return NULL;
}

int main(int argc, char ** argv) {
	//int res=-1;
	int *tab=malloc(2*sizeof(int));
	int i;
	int n=atoi(argv[1]);
	srand(time(NULL));
	pthread_t*tid=malloc(n*sizeof(pthread_t));
	for(i=0; i<20; tab[i++]=(rand()%(1000)+1));
	Tableau *arg=malloc(atoi(argv[1])*sizeof(Tableau));
	
	for(i=0;i<n;++i){
		arg[i].tab=tab;
		arg[i].res=-1;
		arg[i].deb=(20*i)/n; arg[i].fin=(20*(i+1))/n;
		pthread_create(tid+i,NULL,&cherche,arg+i);
	} 
	
	int max=1;
	
	for(i=0; i<0;++i){
		pthread_join(tid[i],NULL);
		max=(max<arg[i].res)?arg[i].res:max;
	}
	printf("%d\n",max);
	free(tab);
	free(arg);
	free(tid);		
	
	return 0;
}
